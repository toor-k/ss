<!DOCTYPE html>
<html>
<head>
    <title>Secure Agent Terminal</title>
    <style>
        /* ... [All previous CSS styles remain unchanged] ... */
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>
<body>
    <!-- ... [All HTML elements remain unchanged] ... -->

    <script>
        // ... [Firebase config and initialization] ...
        // ... [Matrix animation code] ...
        // ... [Authentication system] ...
        // ... [Message handling functions] ...

        // Input Validation Code
        document.getElementById('agentId').addEventListener('input', function(e) {
            this.value = this.value.toLowerCase().replace(/[^0-9a-z-]/g, '');
            if (!/^agent-\d{0,2}$/.test(this.value)) {
                document.getElementById('errorMsg').textContent = 'Format must be agent-XX (numbers only)';
            } else {
                document.getElementById('errorMsg').textContent = '';
            }
        });

        document.getElementById('accessCode').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '').slice(0, 8);
        });

        // Enter key submission for access code
        document.getElementById('accessCode').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') authenticate();
        });

        // Authentication function
        function authenticate() {
            const agentId = document.getElementById('agentId').value.trim().toLowerCase();
            const code = document.getElementById('accessCode').value.trim();
            const errorElement = document.getElementById('errorMsg');

            errorElement.textContent = '';

            if (!/^agent-\d{2}$/.test(agentId)) {
                errorElement.textContent = 'INVALID AGENT ID FORMAT';
                return;
            }

            if (!validAgents[agentId]) {
                errorElement.textContent = 'UNAUTHORIZED ACCESS ATTEMPT';
                return;
            }

            if (code !== validAgents[agentId].code) {
                errorElement.textContent = 'ACCESS CODE VERIFICATION FAILED';
                document.getElementById('accessCode').value = '';
                return;
            }

            currentAgent = validAgents[agentId];
            showTerminalInterface();
        }

        // ... [Terminal interface functions] ...
        // ... [Command processing functions] ...
    </script>
</body>
</html>
